require(["jquery","splunkjs/mvc","splunkjs/mvc/searchmanager","splunkjs/mvc/savedsearchmanager","splunkjs/mvc/postprocessmanager","splunkjs/mvc/simpleform/input/text","splunkjs/mvc/simpleform/input/multiselect","splunkjs/mvc/timerangeview","splunkjs/mvc/dropdownview","/static/app/searchplus/js/searchplus_view.min.js","/static/app/searchplus/js/format.min.js","/static/app/searchplus/js/searchplus_icons.min.js"],(function(t,e,s,a,n,i,l,p,c,d,o){$dashboard=t(".dashboard-body").html(`\n\t\t<div class="sp-view sp-flex-container">\n\t\t\t<div class="sp-filter-container">\n\t\t\t\t<div class="sp-settings-container">\n\t\t\t\t\t<div class="sp-settings sp-clickable">\n\t\t\t\t\t\t${icon_settings}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="sp-settings-menu">\n\t\t\t\t\t\t<div class="sp-settings-item sp-clickable sp-settings-view-search">View Filtered Search</div>\n\t\t\t\t\t\t<div class="sp-settings-item sp-clickable sp-settings-rebuild">Rebuild Search Inventory</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sp-result-count sp-flex-container">${icon_filter}<span class="sp-result-count-value">0</span> Matched Searches</div>\n\t\t\t\t<div class="sp-filter">\n\t\t\t\t\t<div class="sp-input-group">\n\t\t\t\t\t\t<div class="sp-input-group-label sp-flex-container">\n\t\t\t\t\t\t\t<span>General Filters</span>\n\t\t\t\t\t\t\t<span class="sp-filter-toggle sp-clickable sp-filter-toggle-minus">${icon_minus}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_sort}<span>Sort By</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-sort sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_updated}<span>Last Updated</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-updated sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_search}<span>Search</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-keyword sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_app}<span>App</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-app sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_owner}<span>Owner</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-owner sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_status}<span>Status</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-status sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="sp-input-group">\n\t\t\t\t\t\t<div class="sp-input-group-label sp-flex-container">\n\t\t\t\t\t\t\t<span>Attribute Filters</span>\n\t\t\t\t\t\t\t<span class="sp-filter-toggle sp-clickable sp-filter-toggle-minus">${icon_minus}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_commands}<span>Commands</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-command sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_datamodels}<span>Datamodels</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-datamodel sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_fields}<span>Fields</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-field sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_functions}<span>Functions</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-function sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_indexes}<span>Indexes</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-index sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_lookups}<span>Lookups</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-lookup sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_macros}<span>Macros</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-macro sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="sp-input-group">\n\t\t\t\t\t\t<div class="sp-input-group-label sp-flex-container">\n\t\t\t\t\t\t\t<span>Correlation Serach Filters</span>\n\t\t\t\t\t\t\t<span class="sp-filter-toggle sp-clickable sp-filter-toggle-minus">${icon_minus}</span>\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_shield}<span>Correlation Search</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-correlation sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_label}<span>Security Domain</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-domain sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_severity}<span>Severity</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-severity sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_tactics}<span>MITRE ATT&CK Tactic</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-mtr-tactic sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="sp-input-container">\n\t\t\t\t\t\t\t<div class="sp-input-label sp-flex-container">${icon_techniques}<span>MITRE ATT&CK Technique</span></div>\n\t\t\t\t\t\t\t<div class="sp-filter-mtr-technique sp-input"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="sp-search-container">\n\t\t\t\t<div class="sp-search-header sp-search-row sp-flex-container">\n\t\t\t\t\t<div class="sp-search-col"></div>\n\t\t\t\t\t<div class="sp-search-col sp-flex-container">${icon_searchname}<span>Title</span></div>\n\t\t\t\t\t<div class="sp-search-col sp-flex-container">${icon_app}<span>App</span></div>\n\t\t\t\t\t<div class="sp-search-col sp-flex-container">${icon_owner}<span>Owner</span></div>\n\t\t\t\t\t<div class="sp-search-col sp-flex-container">${icon_updated}<span>Updated</span></div>\n\t\t\t\t\t<div class="sp-search-col sp-flex-container">${icon_nextschedule}<span>Next Scheduled Time</span></div>\n\t\t\t\t\t<div class="sp-search-col sp-flex-container">${icon_share}<span>Sharing</span></div>\n\t\t\t\t\t<div class="sp-search-col sp-flex-container">${icon_status}<span>Status</span></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sp-search-list">\n\t\t\t\t</div>\n\t\t\t\t<div class="sp-pagination-container">\n\t\t\t\t\t<div class="sp-pagination"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`);let r=e.Components.get("default");new s({id:"sm_base",data:"results",preview:!0,cache:!0,earliest_time:0,latest_time:"now",search:'| inputlookup sp_search_inventory where (title="*$keyword$*" OR description="*$keyword$*") status=$status$\n\t\t| where _time >= coalesce(relative_time(now(), "$updated$"), 0)\n\t\t| foreach command datamodel field index macro lookup function mtr_tactic mtr_technique\n\t\t\t[eval <<FIELD>>=split(<<FIELD>>, "|")]\n\t\t| foreach command datamodel field index macro lookup function\n\t\t\t[eval <<FIELD>>=lower(<<FIELD>>)]'},{tokens:!0});var u=new s({id:"sm_searchlist",data:"results",preview:!0,cache:!0,earliest_time:0,latest_time:"now",search:'| inputlookup sp_search_inventory where (title="*$keyword$*" OR description="*$keyword$*") status=$status$\n\t| where _time >= coalesce(relative_time(now(), "$updated$"), 0)\n\t| foreach command datamodel field index macro lookup function mtr_tactic mtr_technique\n\t\t[eval <<FIELD>>=lower(split(<<FIELD>>, "|"))]\n\t| fillnull command datamodel field index macro lookup function mtr_tactic mtr_technique security_domain severity value="N/A"\n\t| search correlation_search=$correlation$ security_domain IN ($domain$) severity IN ($severity$) field IN ($field$) app IN ($app$) owner IN ($owner$) command IN ($command$) datamodel IN ($datamodel$) index IN ($index$) macro IN ($macro$) lookup IN ($lookup$) function IN ($function$) mtr_tactic IN ($tactic$) mtr_technique IN ($technique$)\n\t| join type=left title [| inputlookup sp_search_resource_usage.csv]\n\t| fillnull skipped run_time result_count mem_used scan_count value="N/A"\n\t| sort $sort$'},{tokens:!0});b(1,100);var v=new n({id:"ppm_pagination",manager:"sm_searchlist",data:"results",preview:!0,cache:!0,search:"| streamstats count\n\t| search count > $min_offset$  count <= $max_offset$"},{tokens:!0});d=new d({id:"sp_view",managerid:"ppm_pagination",el:t(".dashboard-body .sp-search-list")}).render(),new c({id:"sp_filter_updated",choices:[{label:"All Time",value:"-1000y"},{label:"Last 1 Hour",value:"-1h"},{label:"Last 12 Hours",value:"-12h"},{label:"Last 1 Day",value:"-1d"},{label:"Last 7 Days",value:"-7d"},{label:"Last 1 Month",value:"-1mon"},{label:"Last 6 Months",value:"-6mon"},{label:"Last 1 Year",value:"-1y"}],default:"-1000y",value:"$updated$",el:t(".sp-filter-updated")},{tokens:!0}).render(),new c({id:"sp_filter_sort",choices:[{label:"Title",value:"title"},{label:"App",value:"app"},{label:"Owner",value:"owner"},{label:"Updated",value:"updated"},{label:"Next Scheduled Time",value:"next_scheduled_time"},{label:"Sharing",value:"sharing"},{label:"Status",value:"status"}],default:"title",value:"$sort$",el:t(".sp-filter-sort")},{tokens:!0}).render(),new i({id:"sp_filter_keyword",default:"",value:"$keyword$",el:t(".sp-filter-keyword")},{tokens:!0}).render();new n({id:"ppm_app",managerid:"sm_base",search:"| table app | dedup app | sort app"}),h(new l({id:"sp_filter_app",choices:[{label:"All",value:"*"}],managerid:"ppm_app",labelField:"app",valueField:"app",value:"$app$",el:t(".sp-filter-app")},{tokens:!0}).render()),new n({id:"ppm_owner",managerid:"sm_base",search:"| stats count by owner | sort owner"}),h(new l({id:"sp_filter_owner",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_owner",labelField:"owner",valueField:"owner",value:"$owner$",el:t(".sp-filter-owner")},{tokens:!0}).render());new c({id:"sp_filter_status",choices:[{label:"All",value:"*"},{label:"Enabled",value:"Enabled"},{label:"Disabled",value:"Disabled"}],default:"*",value:"$status$",el:t(".sp-filter-status")},{tokens:!0}).render();new n({id:"ppm_command",managerid:"sm_base",search:"| stats count by command | sort command"}),h(new l({id:"sp_filter_command",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_command",valuePrefix:"command=",delimeter:" OR ",labelField:"command",valueField:"command",value:"$command$",el:t(".sp-filter-command")},{tokens:!0}).render()),new n({id:"ppm_datamodel",managerid:"sm_base",search:"| stats count by datamodel | sort datamodel"}),h(new l({id:"sp_filter_datamodel",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_datamodel",labelField:"datamodel",valueField:"datamodel",value:"$datamodel$",el:t(".sp-filter-datamodel")},{tokens:!0}).render()),h(new l({id:"sp_filter_field",allowCustomValues:!0,choices:[{label:"All",value:"*"}],default:"*",value:"$field$",el:t(".sp-filter-field")},{tokens:!0}).render()),new n({id:"ppm_function",managerid:"sm_base",search:"| stats count by function | sort function"}),h(new l({id:"sp_filter_function",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_function",labelField:"function",valueField:"function",value:"$function$",el:t(".sp-filter-function")},{tokens:!0}).render()),new n({id:"ppm_index",managerid:"sm_base",search:"| stats count by index | sort index"}),h(new l({id:"sp_filter_index",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_index",labelField:"index",valueField:"index",value:"$index$",el:t(".sp-filter-index")},{tokens:!0}).render()),new n({id:"ppm_lookup",managerid:"sm_base",search:"| stats count by lookup | sort lookup"}),h(new l({id:"sp_filter_lookup",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_lookup",labelField:"lookup",valueField:"lookup",value:"$lookup$",el:t(".sp-filter-lookup")},{tokens:!0}).render()),new n({id:"ppm_macro",managerid:"sm_base",search:"| stats count by macro | sort macro"}),h(new l({id:"sp_filter_macro",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_macro",labelField:"macro",valueField:"macro",value:"$macro$",el:t(".sp-filter-macro")},{tokens:!0}).render());new c({id:"sp_filter_correlation",choices:[{label:"All",value:"*"},{label:"Yes",value:"yes"},{label:"No",value:"no"}],default:"*",value:"$correlation$",el:t(".sp-filter-correlation")},{tokens:!0}).render();h(new l({id:"sp_filter_severity",choices:[{label:"All",value:"*"},{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"},{label:"Informational",value:"informational"}],default:"*",value:"$severity$",el:t(".sp-filter-severity")},{tokens:!0}).render()),new n({id:"ppm_domain",managerid:"sm_base",search:"| stats count by security_domain | sort security_domain"}),h(new l({id:"sp_filter_domain",choices:[{label:"All",value:"*"}],default:"*",value:"$domain$",managerid:"ppm_domain",labelField:"security_domain",valueField:"security_domain",el:t(".sp-filter-domain")},{tokens:!0}).render()),new n({id:"ppm_tactic",managerid:"sm_base",search:'| stats count by mtr_tactic | sort mtr_tactic | eval mtr_tactic_quoted="\\"".mtr_tactic."\\""'}),h(new l({id:"sp_filter_tactic",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_tactic",labelField:"mtr_tactic",valueField:"mtr_tactic_quoted",value:"$tactic$",el:t(".sp-filter-mtr-tactic")},{tokens:!0}).render()),new n({id:"ppm_technique",managerid:"sm_base",search:'| stats count by mtr_technique | sort mtr_technique | eval mtr_technique_quoted="\\"".mtr_technique."\\""'}),h(new l({id:"sp_filter_techniuqe",choices:[{label:"All",value:"*"}],default:"*",managerid:"ppm_technique",labelField:"mtr_technique",valueField:"mtr_technique_quoted",value:"$technique$",el:t(".sp-filter-mtr-technique")},{tokens:!0}).render()),u.on("search:done",(function(e){let s=this.data("results").attributes.manager.attributes.data.resultCount;t(".sp-result-count-value",$dashboard).html(s),_(t(".sp-pagination",$dashboard),s,1)})),v.on("search:done",(function(t){console.log(this.query.attributes.search)})),t(".sp-input-group").each((function(){f(t(this))})),t(".sp-filter-toggle").on("click",(function(){t(this).closest(".sp-input-group").toggleClass("closed"),t(this).hasClass("sp-filter-toggle-minus")?(t(this).html(icon_plus),t(this).removeClass("sp-filter-toggle-minus").addClass("sp-filter-toggle-plus")):t(this).hasClass("sp-filter-toggle-plus")&&(t(this).html(icon_minus),t(this).removeClass("sp-filter-toggle-plus").addClass("sp-filter-toggle-minus"))})),t(".sp-filter-container").click((function(){t(".sp-settings-menu").hide()})),t(".sp-settings").on("click",(function(e){e.stopPropagation(),t(".sp-settings-menu").toggle()})),t(".sp-settings-view-search").on("click",(function(e){let s=u.query.attributes.search,a="/app/searchplus/search?q="+encodeURIComponent(s),n=t(`\n\t\t<div class="modal fade modal-wide">\n\t\t\t<div class="modal-header">\n\t\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n\t\t\t\t<h3>Filtered Search Inventory</h3>\n\t\t\t</div>\n\t\t\t<div class="modal-body">\n\t\t\t\t<div class="sp-query-overflow">\n\t\t\t\t\t<div class="sp-search-query">${o(s,!0,!0)}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="modal-footer">\n\t\t\t\t<a href="#" data-dismiss="modal" class="btn">Cancel</a>\n\t\t\t\t<a href="${a}" target="_blank" class="btn btn-primary">Run in Search</a>\n\t\t\t</div>\n\t\t</div>`);n.on("hidden.bs.modal",(()=>{n.remove()})),t("body").append(n),n.modal("show")}));let m=new a({id:"build_inventory_ssm",searchname:"Search Inventory - Lookup Gen",preview:!0,"dispatch.earliest_time":"0","dispatch.latest_time":"now",app:"searchplus",autostart:!1});function f(t){t.css("height","auto");let e=t.prop("scrollHeight");t.css("height",e+"px")}function h(e){e.on("change",(s=>{0==s.length||s.length>1&&"*"==s[s.length-1]?e.val("*"):s.length>1&&"*"==s[0]&&e.val(s[1]),f(t(e.el.closest(".sp-input-group")))}))}function _(e,s,a){e.html("");let n=100,i=Math.ceil(s/n);if(1==i)return;let l=function(t,e,s){const a=Math.max(1,Math.min(e-Math.floor((t-3)/2),s-t+2)),n=Math.min(s,Math.max(e+Math.floor((t-2)/2),t-1));return[...a>2?[1,"..."]:a>1?[1]:[],...Array.from({length:n+1-a},((t,e)=>e+a)),...n<s-1?["...",s]:n<s?[s]:[]]}(7,a,i);a>1&&e.append(`<div class="sp-page sp-page-prev sp-clickable">${icon_arrow_left}</div>`),l.forEach((function(i){$page=t(`<div class="sp-page ${i==a?"selected":""}">${i}</div>`),"..."!=i&&i!=a&&($page.addClass("sp-clickable"),$page.attr("data-attr-page",i),$page.on("click",(function(){b(i,n),_(e,s,i)}))),$page.appendTo(e)})),a<i&&e.append(`<div class="sp-page sp-page-next sp-clickable">${icon_arrow_right}</div>`),t(".sp-page-prev",e).on("click",(function(){new_page=a-1,b(new_page,n),_(e,s,new_page)})),t(".sp-page-next",e).on("click",(function(){new_page=a+1,b(new_page,n),_(e,s,new_page)}))}function b(t,e){let s=(t-1)*e,a=t*e;r.set("min_offset",s),r.set("max_offset",a)}t(".sp-settings-rebuild").on("click",(function(e){let s=t('\n\t\t<div class="modal fade" data-backdrop="static">\n\t\t\t<div class="modal-header">\n\t\t\t\t<span class="sp-loader"></span> Rebuilding Search Inventory ...\n\t\t\t</div>\n\t\t</div>');s.on("hidden.bs.modal",(()=>{s.remove()})),t("body").append(s),s.modal("show"),m.startSearch(),m.on("search:progress",(function(t){console.log(t)})),m.on("search:done",(function(t){s.modal("hide"),u.startSearch()})),m.on("search:failed search:error",(function(e){t(".modal-header").html(`<h3>${icon_alert} Error</h3>`),s.append(`\n\t\t\t\t<div class="modal-body">${e}</div>\n\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t<a href="#" data-dismiss="modal" class="btn">Close</a>\n\t\t\t\t</div>\n\t\t\t`)}))}))}));