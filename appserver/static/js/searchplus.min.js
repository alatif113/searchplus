require(["jquery","splunkjs/mvc","splunkjs/mvc/searchmanager","splunkjs/mvc/savedsearchmanager","splunkjs/mvc/postprocessmanager","splunkjs/mvc/simpleform/input/text","splunkjs/mvc/simpleform/input/multiselect","splunkjs/mvc/dropdownview","/static/app/searchplus/js/sp_view.min.js","/static/app/searchplus/js/format.min.js","/static/app/searchplus/js/simplebar.min.js"],(function(e,n,a,i,s,t,l,o,c,r){let d=n.Components.get("default");M(1,100);let u=e(".dashboard-body").html('\n        <div class="view-container">\n            <section aria-label="Search Filters" class="sidebar">\n                <header class="sidebar-header">\n                    <i class="icon icon-filter"></i><span class="result-count">0</span><span> Matched Searches</span>\n                    <button class="btn-more btn-transparent"><i class="icon icon-more right-align"></i></button>\n                </header>\n                <div class="sidebar-content" data-simplebar>\n                    <section aria-label="General Filters" class="input-group">\n                        <header class="input-group-label">\n                            <h1>General Filters</h1>\n                            <button class="btn-transparent"><i class="icon icon-minus right-align"></i></button>\n                        </header>\n                        <div class="input-container">\n                            <label><i class="icon icon-sort"></i>Sort By</label>\n                            <div class="splunk-input-container input-sort"></div>\n                        </div>\n\t\t\t\t\t\t<div class="input-container">\n                            <label><i class="icon icon-sort"></i>Sort Order</label>\n                            <div class="splunk-input-container input-sortorder"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-clock"></i>Last Updated</label>\n                            <div class="splunk-input-container input-updated"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-search"></i>Title / Description</label>\n                            <div class="splunk-input-container input-keyword"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-folder"></i>App</label>\n                            <div class="splunk-input-container input-app"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-user"></i>Owner</label>\n                            <div class="splunk-input-container input-owner"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-toggle"></i>Status</label>\n                            <div class="splunk-input-container input-status"></div>\n                        </div>\n                    </section>\n                    <section aria-label="Attribute Filters" class="input-group">\n                        <header class="input-group-label">\n                            <h1>Attribute Filters</h1>\n                            <button class="btn-transparent"><i class="icon icon-minus right-align"></i></button>\n                        </header>\n                        <div class="input-container">\n                            <label><i class="icon icon-command"></i>Commands</label>\n                            <div class="splunk-input-container input-command"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-datamodel"></i>Datamodels</label>\n                            <div class="splunk-input-container input-datamodel"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-field"></i>Fields</label>\n                            <div class="splunk-input-container input-field"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-function"></i>Functions</label>\n                            <div class="splunk-input-container input-function"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-index"></i>Indexes</label>\n                            <div class="splunk-input-container input-index"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-lookup"></i>Lookups</label>\n                            <div class="splunk-input-container input-lookup"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-macro"></i>Macros</label>\n                            <div class="splunk-input-container input-macro"></div>\n                        </div>\n                    </section>\n                    <section aria-label="Correlation Search Filters" class="input-group">\n                        <header class="input-group-label">\n                            <h1>Correlation Search Filters</h1>\n                            <button class="btn-transparent"><i class="icon icon-minus right-align"></i></button>\n                        </header>\n                        <div class="input-container">\n                            <label><i class="icon icon-correlation"></i>Correlation Search</label>\n                            <div class="splunk-input-container input-correlation"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-securitydomain"></i>Security Domain</label>\n                            <div class="splunk-input-container input-securitydomain"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-severity"></i>Severity</label>\n                            <div class="splunk-input-container input-severity"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-tactic"></i>MITRE ATT&CK Tactics</label>\n                            <div class="splunk-input-container input-tactic"></div>\n                        </div>\n                        <div class="input-container">\n                            <label><i class="icon icon-technique"></i>MITRE AYY&CK Techniques</label>\n                            <div class="splunk-input-container input-technique"></div>\n                        </div>\n                    </section>\n                </div>\n            </section>\n            <section class="content">\n                <header class="content-header">\n                    <div role="none"></div>\n                    <div><i class="icon icon-search"></i>Title</div>\n                    <div><i class="icon icon-folder"></i>App</div>\n                    <div><i class="icon icon-user"></i>Owner</div>\n                    <div><i class="icon icon-clock"></i>Updated</div>\n                    <div><i class="icon icon-calendar"></i>Next Scheduled Time</div>\n                    <div><i class="icon icon-share"></i>Sharing</div>\n                    <div><i class="icon icon-toggle"></i>Status</div>\n                </header>\n\t\t\t\t<div class="scroll-container" data-simplebar>\n\t\t\t\t\t<ol class="search-results">\n\t\t\t\t\t</ol>\n\t\t\t\t</div>\n                <ul class="pagination" role="list"></ul>\n            </section>\n        </div>\n    '),p=(new a({id:"sm_inputs",data:"results",preview:!0,cache:!0,search:'| inputlookup sp_search_inventory where status=$status$\n\t\t| search title="*$keyword$*" OR description="*$keyword$*"\n        | where _time >= coalesce(relative_time(now(), "$updated$"), 0)\n        | foreach command datamodel field index macro lookup function mtr_tactic mtr_technique\n            [eval <<FIELD>>=split(<<FIELD>>, "|")]'},{tokens:!0}),new a({id:"sm_content",data:"results",preview:!0,cache:!0,search:'| inputlookup sp_search_inventory where status=$status$\n\t\t| search title="*$keyword$*" OR description="*$keyword$*"\n        | where _time >= coalesce(relative_time(now(), "$updated$"), 0)\n        | foreach command datamodel field index macro lookup function mtr_tactic mtr_technique\n            [eval <<FIELD>>=lower(split(<<FIELD>>, "|"))]\n        | fillnull command datamodel field index macro lookup function mtr_tactic mtr_technique security_domain severity value="N/A"\n        | search correlation_search=$correlation$ security_domain IN ($securitydomain$) severity IN ($severity$) field IN ($field$) app IN ($app$) owner IN ($owner$) command IN ($command$) datamodel IN ($datamodel$) index IN ($index$) macro IN ($macro$) lookup IN ($lookup$) function IN ($function$) mtr_tactic IN ($tactic$) mtr_technique IN ($technique$)\n        | join type=left title [| inputlookup sp_search_resource_usage.csv]\n        | sort $sortorder$$sort$'},{tokens:!0})),m=(new s({id:"sm_pagination",manager:"sm_content",data:"results",preview:!0,cache:!0,search:"| streamstats count\n\t\t| search count > $min_offset$  count <= $max_offset$"},{tokens:!0}),new i({id:"sm_rebuild",searchname:"Search Inventory - Lookup Gen",app:"searchplus",autostart:!1})),v=new i({id:"sm_resource",searchname:"Search Resource Usage - Lookup Gen",app:"searchplus",autostart:!1}),h=(new c({id:"view_searchplus",managerid:"sm_pagination",el:e(".dashboard-body .search-results")}).render(),[]),b=new o({id:"input_updated",choices:[{label:"All Time",value:"-1000y"},{label:"Last 1 Hour",value:"-1h"},{label:"Last 12 Hours",value:"-12h"},{label:"Last 1 Day",value:"-1d"},{label:"Last 7 Days",value:"-7d"},{label:"Last 1 Month",value:"-1mon"},{label:"Last 6 Months",value:"-6mon"},{label:"Last 1 Year",value:"-1y"}],default:"-1000y",value:"$updated$",el:e(".input-updated")},{tokens:!0}).render();h.push(b);let g=new o({id:"input_sort",choices:[{label:"Title",value:"title"},{label:"App",value:"app"},{label:"Owner",value:"owner"},{label:"Updated",value:"updated"},{label:"Next Scheduled Time",value:"next_scheduled_time"},{label:"Sharing",value:"sharing"},{label:"Status",value:"status"},{label:"Skipped Percentage",value:"skipped"},{label:"Avg. Memory Used",value:"mem_used"},{label:"Avg. Run Time",value:"run_time"},{label:"Avg. Events Scanned",value:"scan_count"},{label:"Avg. Result Count",value:"result_count"}],default:"title",value:"$sort$",el:e(".input-sort")},{tokens:!0}).render();h.push(g);let f=new o({id:"input_sortorder",choices:[{label:"Ascending",value:"+"},{label:"Descending",value:"-"}],default:"+",value:"$sortorder$",el:e(".input-sortorder")},{tokens:!0}).render();h.push(f);let _=new t({id:"input_keyword",default:"",value:"$keyword$",el:e(".input-keyword")},{tokens:!0}).render();h.push(_),new s({id:"sm_app",managerid:"sm_inputs",search:"| table app | dedup app | sort app"});var k=new l({id:"input_app",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_app",labelField:"app",valueField:"app",value:"$app$",el:e(".input-app")},{tokens:!0}).render();h.push(k),j(k),new s({id:"sm_owner",managerid:"sm_inputs",search:"| stats count by owner | sort owner"});let $=new l({id:"input_owner",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_owner",labelField:"owner",valueField:"owner",value:"$owner$",el:e(".input-owner")},{tokens:!0}).render();h.push($),j($);let y=new o({id:"input_status",choices:[{label:"All",value:"*"},{label:"Enabled",value:"enabled"},{label:"Disabled",value:"disabled"}],default:"*",value:"$status$",el:e(".input-status")},{tokens:!0}).render();h.push(y),new s({id:"sm_command",managerid:"sm_inputs",search:"| stats count by command | sort command"});let w=new l({id:"input_command",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_command",labelField:"command",valueField:"command",value:"$command$",el:e(".input-command")},{tokens:!0}).render();h.push(w),j(w),new s({id:"sm_datamodel",managerid:"sm_inputs",search:"| stats count by datamodel | sort datamodel"});let C=new l({id:"input_datamodel",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_datamodel",labelField:"datamodel",valueField:"datamodel",value:"$datamodel$",el:e(".input-datamodel")},{tokens:!0}).render();h.push(C),j(C);let q=new l({id:"input_field",allowCustomValues:!0,choices:[{label:"All",value:"*"}],default:"*",value:"$field$",el:e(".input-field")},{tokens:!0}).render();h.push(q),j(q),new s({id:"sm_function",managerid:"sm_inputs",search:"| stats count by function | sort function"});let x=new l({id:"input_function",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_function",labelField:"function",valueField:"function",value:"$function$",el:e(".input-function")},{tokens:!0}).render();h.push(x),j(x),new s({id:"sm_index",managerid:"sm_inputs",search:"| stats count by index | sort index"});let F=new l({id:"input_index",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_index",labelField:"index",valueField:"index",value:"$index$",el:e(".input-index")},{tokens:!0}).render();h.push(F),j(F),new s({id:"sm_lookup",managerid:"sm_inputs",search:"| stats count by lookup | sort lookup"});let A=new l({id:"input_lookup",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_lookup",labelField:"lookup",valueField:"lookup",value:"$lookup$",el:e(".input-lookup")},{tokens:!0}).render();h.push(A),j(A),new s({id:"sm_macro",managerid:"sm_inputs",search:"| stats count by macro | sort macro"});let S=new l({id:"input_macro",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_macro",labelField:"macro",valueField:"macro",value:"$macro$",el:e(".input-macro")},{tokens:!0}).render();h.push(S),j(S);new o({id:"input_correlation",choices:[{label:"All",value:"*"},{label:"Yes",value:"yes"},{label:"No",value:"no"}],default:"*",value:"$correlation$",el:e(".input-correlation")},{tokens:!0}).render();var I=new l({id:"input_severity",choices:[{label:"All",value:"*"},{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"},{label:"Informational",value:"informational"}],default:"*",value:"$severity$",el:e(".input-severity")},{tokens:!0}).render();h.push(I),j(I),new s({id:"sm_securitydomain",managerid:"sm_inputs",search:"| stats count by security_domain | sort security_domain"});var R=new l({id:"input_securitydomain",choices:[{label:"All",value:"*"}],default:"*",value:"$securitydomain$",managerid:"sm_securitydomain",labelField:"security_domain",valueField:"security_domain",el:e(".input-securitydomain")},{tokens:!0}).render();h.push(R),j(R),new s({id:"sm_tactic",managerid:"sm_inputs",search:'| stats count by mtr_tactic | sort mtr_tactic | eval mtr_tactic_quoted="\\"".mtr_tactic."\\""'});var L=new l({id:"input_tactic",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_tactic",labelField:"mtr_tactic",valueField:"mtr_tactic_quoted",value:"$tactic$",el:e(".input-tactic")},{tokens:!0}).render();h.push(L),j(L),new s({id:"sm_technique",managerid:"sm_inputs",search:'| stats count by mtr_technique | sort mtr_technique | eval mtr_technique_quoted="\\"".mtr_technique."\\""'});var T=new l({id:"input_techniuqe",choices:[{label:"All",value:"*"}],default:"*",managerid:"sm_technique",labelField:"mtr_technique",valueField:"mtr_technique_quoted",value:"$technique$",el:e(".input-technique")},{tokens:!0}).render();function j(n){n.on("change",(a=>{0==a.length||a.length>1&&"*"==a[a.length-1]?n.val("*"):a.length>1&&"*"==a[0]&&n.val(a[1]);e(n.el.closest(".input-container"))}))}function N(n,a,i){n.html("");let s=100,t=Math.ceil(a/s);if(1==t)return;let l=function(e,n,a){const i=Math.max(1,Math.min(n-Math.floor((e-3)/2),a-e+2)),s=Math.min(a,Math.max(n+Math.floor((e-2)/2),e-1));return[...i>2?[1,"..."]:i>1?[1]:[],...Array.from({length:s+1-i},((e,n)=>n+i)),...s<a-1?["...",a]:s<a?[a]:[]]}(7,i,t);i>1&&n.append('<li class="pagination-page pagination-prev pagination-clickable"><i class="icon icon-arrow-left right-align"></i></li>'),l.forEach((function(t){$page=e(`<li class="pagination-page ${t==i?"selected":""}">${t}</li>`),"..."!=t&&t!=i&&($page.addClass("pagination-clickable"),$page.attr("data-attr-page",t),$page.on("click",(function(){M(t,s),N(n,a,t)}))),$page.appendTo(n)})),i<t&&n.append('<li class="pagination-page pagination-next pagination-clickable"><i class="icon icon-arrow-right right-align"></i></li>'),e(".pagination-prev",n).on("click",(function(){new_page=i-1,M(new_page,s),N(n,a,new_page)})),e(".pagination-next",n).on("click",(function(){new_page=i+1,M(new_page,s),N(n,a,new_page)}))}function M(e,n){let a=(e-1)*n,i=e*n;d.set("min_offset",a),d.set("max_offset",i)}function M(e,n){let a=(e-1)*n,i=e*n;d.set("min_offset",a),d.set("max_offset",i)}function D(e=!1){let n=window.location.origin+window.location.pathname+"?",a=[];for(input of h){let e=input.options.default,n=input.val();if(e!=n){let e=input.options.value.replace(/\$/g,"");if(Array.isArray(n))for(val of n)a.push(`${e}=${encodeURIComponent(val)}`);else a.push(`${e}=${encodeURIComponent(n)}`)}}return n+=e?a.join("&amp;"):a.join("&"),n}h.push(T),j(T),p.on("search:done",(function(n){let a=this.data("results").attributes.manager.attributes.data.resultCount;e(".result-count",u).html(a.toLocaleString()),N(e(".pagination",u),a,1)})),e(".input-group-label button").on("click",(function(){e(this).closest("section").children("div").toggle();let n=e("i.icon",e(this));n.hasClass("icon-minus")?n.removeClass("icon-minus").addClass("icon-plus"):n.removeClass("icon-plus").addClass("icon-minus")})),e(".btn-more").on("click",(function(n){let a=p.query.attributes.search,i="/app/searchplus/search?q="+encodeURIComponent(a),s=e(`\n            <div class="modal fade modal-wide">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                    <h1>Search+ Configuration</h1>\n                </div>\n                <div class="modal-body">\n                    <section class="">\n                        <h2>Filtered Search Query</h2>\n                        <p>The filtered search list is generated using this query.</p>\n                        <div class="query-container">    \n                            <div class="query-overflow" data-simplebar>\n                                <div class="spl-query">${r(a)}</div>\n                            </div>\n                            <menu role="list">\n                                <li><a href="${i}" target="_blank" class="query-search btn-primary"><i class="icon icon-search"></i>Search</a></li>\n                                <li><a href="#" class="query-copy btn-primary"><i class="icon icon-copy"></i>Copy</a></li>\n                            </menu>\n                        </div>\n\t\t\t\t\t\t<p>The filtered search list can be accessed using this link.</p>\n\t\t\t\t\t\t<div class="query-container">    \n                            <div class="query-overflow" data-simplebar>\n                                <div class="spl-query">${D(!0)}</div>\n                            </div>\n                            <menu role="list">\n                                <li><a href="${D()}" target="_blank" class="btn-primary"><i class="icon icon-external"></i>Open</a></li>\n                                <li><a href="#" class="query-copy btn-primary"><i class="icon icon-copy"></i>Copy</a></li>\n                            </menu>\n                        </div>\n                    </section>\n                    <section>\n                        <h2>Rebuild Search Inventory</h2>\n                        <p>Run the <span class="code">Search Inventory - Lookup Gen</span> lookup generation search to re-populate the <span class="code">search_inventory</span> KV store. This automatically occurs once a day by default.</p>\n                        <button class="btn-primary btn-rebuild"><i class="icon icon-refresh"></i>Rebuild Search Inventory</button><span class="rebuild-message message"><i class="icon icon-refresh animate-rotate"></i><span> Rebuilding...</span></span>\n                    </section>\n\t\t\t\t\t<section>\n                        <h2>Rebuild Resource Usage Lookup</h2>\n                        <p>Run the <span class="code">Search Resource Usage - Lookup Gen</span> lookup generation search to re-populate the <span class="code">sp_search_resource_usage.csv</span> lookup table. This automatically occurs once a day by default.</p>\n                        <button class="btn-primary btn-resource"><i class="icon icon-refresh"></i>Rebuild Resource Usage</button><span class="resource-message message"><i class="icon icon-refresh animate-rotate"></i><span> Rebuilding...</span></span>\n                    </section>\n                </div>\n                <div class="modal-footer">\n                </div>\n            </div>`);e(".query-copy",s).on("click",(function(){let n=e(".spl-query",e(this).closest(".query-container")).text(),a=e("i.icon",e(this));navigator.clipboard.writeText(n).then((function(){a.removeClass("icon-copy").addClass("animate-bounce-in icon-check").delay(1e3).queue((function(){a.removeClass("animate-bounce-in icon-check").addClass("icon-copy").dequeue()}))}))})),e(".btn-rebuild",s).on("click",(function(){e(".btn-rebuild").addClass("disabled"),e(".close",s).addClass("disabled"),e(".modal-backdrop").addClass("disabled"),e(".rebuild-message i.icon",s).removeClass().addClass("icon icon-refresh animate-rotate"),e(".rebuild-message").removeClass("error").removeClass("success"),e(".rebuild-message span").text("Rebuilding..."),e(".rebuild-message",s).show();e(this).closest("section");m.startSearch(),m.on("search:done search:failed search:error search:canceled",(function(n){e(".btn-rebuild").removeClass("disabled"),e(".close",s).removeClass("disabled"),e(".modal-backdrop").removeClass("disabled")})),m.on("search:done",(function(n){p.startSearch(),e(".rebuild-message i.icon",s).removeClass().addClass("icon icon-check"),e(".rebuild-message").removeClass("error").addClass("success"),e(".rebuild-message span").text("Complete!")})),m.on("search:failed search:error",(function(n){e(".rebuild-message i.icon",s).removeClass().addClass("icon icon-error"),e(".rebuild-message").removeClass("success").addClass("error"),e(".rebuild-message span").text(n)}))})),e(".btn-resource",s).on("click",(function(){e(".btn-resource").addClass("disabled"),e(".close",s).addClass("disabled"),e(".modal-backdrop").addClass("disabled"),e(".resource-message i.icon",s).removeClass().addClass("icon icon-refresh animate-rotate"),e(".resource-message").removeClass("error").removeClass("success"),e(".resource-message span").text("Rebuilding..."),e(".resource-message",s).show();e(this).closest("section");v.startSearch(),v.on("search:done search:failed search:error search:canceled",(function(n){e(".btn-resource").removeClass("disabled"),e(".close",s).removeClass("disabled"),e(".modal-backdrop").removeClass("disabled")})),v.on("search:done",(function(n){p.startSearch(),e(".resource-message i.icon",s).removeClass().addClass("icon icon-check"),e(".resource-message").removeClass("error").addClass("success"),e(".resource-message span").text("Complete!")})),v.on("search:failed search:error",(function(n){e(".resource-message i.icon",s).removeClass().addClass("icon icon-error"),e(".resource-message").removeClass("success").addClass("error"),e(".resource-message span").text(n)}))})),s.on("hidden.bs.modal",(()=>{s.remove()})),e("body").append(s),s.modal("show")}))}));