define(["underscore","jquery","splunkjs/mvc/simplesplunkview","/static/app/searchplus/js/format.min.js","/static/app/searchplus/js/simplebar.min.js"],(function(e,a,t,i){return t.extend({className:"spview",options:{data:"preview",outputMode:"json"},createView:function(){return this},formatData:function(a){let t=this.resultsModel.data().fields;return e.map(a,(function(a){return e.object(t,a)}))},updateView:function(e,t){e.$el.html(""),t.forEach((function(t){let n="/app/searchplus/search?q=search%20",s=n+encodeURIComponent(`index=_internal sourcetype=scheduler status=skipped savedsearch_name="${t.title}"`)+"&earliest=-7d&latest=now",c=n+encodeURIComponent(`index=_internal sourcetype=scheduler run_time=* savedsearch_name="${t.title}"`)+"&earliest=-7d&latest=now",l=n+encodeURIComponent(`index=_introspection sourcetype=splunk_resource_usage data.search_props.sid::* data.search_props.mode!=RT data.search_props.user!="splunk-system-user" data.search_props.label="${t.title}" | rename data.search_props.label as savedsearch_name data.mem_used as mem_used`)+"&earliest=-7d&latest=now",r=n+encodeURIComponent(`index=_audit sourcetype=audittrail search_id=* action=search savedsearch_name="${t.title}"`)+"&earliest=-7d&latest=now",d=n+encodeURIComponent(`index=_internal sourcetype=scheduler result_count=* savedsearch_name="${t.title}"`)+"&earliest=-7d&latest=now",o=`/app/${t.app}/search?q=${/^\s*\|/.test(t.search)?"":"search%20"}${encodeURIComponent(t.search)}&earliest=${t.earliest||"-24h"}&latest=${t.latest||"now"}`,v=`/manager/searchplus/saved/searches?app=${t.app}&count=10&offset=0&itemType=&owner=${t.owner}&search=%22${encodeURIComponent(t.title)}%22`,u=`/app/SplunkEnterpriseSecuritySuite/correlation_search_edit?search=${encodeURIComponent(t.title)}`,p="yes"==t.correlation_search?u:v,h=a(`\n                    <li>\n                        <div class="search-header">\n                            <div><i class="icon icon-arrow-right"></i></div>\n                            <div>${t.title}</div>\n                            <div>${t.app}</div>\n                            <div>${t.owner}</div>\n                            <div>${t.updated}</div>\n                            <div>${t.next_scheduled_time}</div>\n                            <div>${t.sharing}</div>\n                            <div><i class="icon icon-${t.status}"></i>${t.status}</div>\n                        </div>\n                        <div class="search-details">\n                            <div class="nav-container">\n                                <nav role="tablist">\n                                    <a href="#" aria-controls="general" role="tab" class="selected">General</a>\n                                    <a href="#" aria-controls="attributes" role="tab">Attributes</a>\n                                    <a href="#" aria-controls="statistics" role="tab">Statistics</a>\n                                </nav>\n                                <a target="_blank" href="${p}" class="btn-edit-search btn-light"><i class="icon icon-external"></i>Edit Search</a>\n                            </div>\n                            <div class="search-details-content">\n                                <section id="general" role="tabpanel" class="selected">\n                                    <div class="query-container">\n                                        <div class="query-overflow" data-simplebar>\n                                            <div class="spl-query">${i(t.search)}</div>\n                                        </div>\n                                        <menu role="list">\n                                            <li><a href="${o}" target="_blank" class="query-search btn-primary"><i class="icon icon-search"></i>Search</a></li>\n                                            <li><a href="#" class="query-copy btn-primary"><i class="icon icon-copy"></i>Copy</a></li>\n                                        </menu>\n                                    </div>\n                                    <div class="description-container">\n                                        <div class="timing-container">\n                                            <span class="icon-tag" data-attr-tooltip="Timespan"><i class="icon icon-timespan"></i><span>${t.earliest||"N/A"} - ${t.latest||"N/A"}</span></span>\n                                            <span class="icon-tag" data-attr-tooltip="Schedule"><i class="icon icon-calendar"></i><span>${t.cron_schedule||"Not Scheduled"}</span></span>\n                                        </div>\n                                        <h2>Description</h2>\n                                        <p>${t.description||"No description."}</p>\n                                    </div>\n                                </section>\n                                <section id="attributes" role="tabpanel" class="hidden">\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-command"></i>Commands</div>\n                                        <div class="attribute-container">${e._makeAttrMarkup(t.command)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-datamodel"></i>Datamodels</div>\n                                        <div class="attribute-container">${e._makeAttrMarkup(t.datamodel)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-field"></i>Fields</div>\n                                        <div class="attribute-container">${e._makeAttrMarkup(t.field)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-function"></i>Functions</div>\n                                        <div class="attribute-container">${e._makeAttrMarkup(t.function)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-index"></i>Indexes</div>\n                                        <div class="attribute-container">${e._makeAttrMarkup(t.index)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-lookup"></i>Lookups</div>\n                                        <div class="attribute-container">${e._makeAttrMarkup(t.lookup)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-macro"></i>Macros</div>\n                                        <div class="attribute-container">${e._makeAttrMarkup(t.macro)}</div>\n                                    </div>\n                                </section>\n                                <section id="statistics" role="tabpanel" class="hidden">\n                                    <div class="stat-${t.skipped_status||"green"}">\n                                        <div class="stat-label">Skipped Percent</div>\n                                        <div class="stat-value">${t.skipped||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" href="${s}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.run_time_status||"green"}">\n                                        <div class="stat-label">Average Run Time</div>\n                                        <div class="stat-value">${t.run_time||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" href="${c}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.mem_used_status||"green"}">\n                                        <div class="stat-label">Average Memory Used</div>\n                                        <div class="stat-value">${t.mem_used||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" href="${l}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.scan_count_status||"green"}">\n                                        <div class="stat-label">Average Events Scanned</div>\n                                        <div class="stat-value">${t.scan_count||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" href="${r}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.result_count_status||"green"}">\n                                        <div class="stat-label">Average Result Count</div>\n                                        <div class="stat-value">${t.result_count||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" href="${d}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                </section>\n                            </div>\n                        </div>\n                    </li>\n                `);"yes"==t.correlation_search&&(a(".search-details nav",h).append('<a href="#" aria-controls="correlation" role="tab">Correlation Search</a>'),a(".search-details-content",h).append(`\n                        <section id="correlation" role="tabpanel" class="hidden">\n                            <div>\n                                <div class="attribute-label"><i class="icon icon-correlation"></i>Correlation Details</div>\n                                <div class="attribute-container">\n                                    <dl><dt>Security Domain:</dt><dd> ${t.security_domain||"N/A"}</dd></dl>\n                                    <dl><dt>Severity:</dt><dd> ${t.severity||"N/A"}</dd></dl>\n                                    <dl><dt>Risk Analysis:</dt><dd> ${t.risk||"N/A"}</dd></dl>\n                                    <dl><dt>Notable Event:</dt><dd> ${t.notable||"N/A"}</dd></dl>\n                                </div>\n                            </div>\n                            <div>\n                                <div class="attribute-label"><i class="icon icon-tactic"></i>MITRE ATT&CK Tactic</div>\n                                <div class="attribute-container">${e._makeAttrMarkup(t.mtr_tactic)}</div>\n                            </div>\n                            <div>\n                                <div class="attribute-label"><i class="icon icon-tactic"></i>MITRE ATT&CK Technique</div>\n                                <div class="attribute-container">${e._makeAttrMarkup(t.mtr_technique)}</div>\n                            </div>\n                        </section>\n                    `)),a(".search-header",h).on("click",(function(){$parent=a(this).parent(),a(".search-results li.selected").not($parent).removeClass("selected"),$parent.toggleClass("selected")})),a(".search-details nav a",h).on("click",(function(){if(a(this).hasClass("selected"))return;let e=a(this).closest(".search-details");a("nav a.selected",e).removeClass("selected"),a(this).addClass("selected");let t=a(this).attr("aria-controls");a(".search-details-content section",e).not(`#${t}`).removeClass("selected").addClass("hidden"),a(`#${t}`,e).removeClass("hidden").addClass("selected")})),a(".query-copy",h).on("click",(function(){let e=a(".spl-query",a(this).closest(".query-container")).text(),t=a("i.icon",a(this));navigator.clipboard.writeText(e).then((function(){t.removeClass("icon-copy").addClass("animate-bounce-in icon-check").delay(1e3).queue((function(){t.removeClass("animate-bounce-in icon-check").addClass("icon-copy").dequeue()}))}))})),e.$el.append(h)}))},_makeAttrMarkup:function(e){if(!e)return"";Array.isArray(e)||(e=[e]);let a="";return e.forEach((e=>{"N/A"!=e&&""!=e&&(a+=`<span class="tag">${e}</span>`)})),a}})}));