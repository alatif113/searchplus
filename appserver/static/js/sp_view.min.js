define(["underscore","jquery","splunkjs/mvc/simplesplunkview","/static/app/searchplus/js/format.min.js","/static/app/searchplus/js/simplebar.min.js"],(function(a,e,t,i){return t.extend({className:"sp-view",options:{data:"preview",outputMode:"json"},createView:function(){return this},formatData:function(e){let t=this.resultsModel.data().fields;return a.map(e,(function(e){return a.object(t,e)}))},updateView:function(a,t){a.$el.html(""),t.forEach((function(t){let n="/app/searchplus/search?q=search%20",s="&earliest=-7d&latest=now&&display.page.search.tab=visualizations&display.general.type=visualizations",c=n+encodeURIComponent(`index=_internal sourcetype=scheduler savedsearch_name="${t.title}" | eval latency=(dispatch_time-scheduled_time)/60 | timechart span=1h avg(latency) as latency`)+s,l=n+encodeURIComponent(`index=_internal sourcetype=scheduler savedsearch_name="${t.title}" | timechart span=1h count(eval(status="skipped")) as skipped count as total | eval skipped=(skipped / total) * 100 | table _time skipped`)+s,r=n+encodeURIComponent(`index=_internal sourcetype=scheduler run_time=* savedsearch_name="${t.title}" | eval run_time=run_time/60 | timechart span=1h avg(run_time) as run_time`)+s,d=n+encodeURIComponent(`index=_introspection sourcetype=splunk_resource_usage data.search_props.sid::* data.search_props.mode!=RT data.search_props.user!="splunk-system-user" data.search_props.label="${t.title}" | rename data.mem_used as mem_used | timechart span=1h avg(mem_used) as mem_used`)+s,o=n+encodeURIComponent(`index=_audit sourcetype=audittrail search_id=* action=search savedsearch_name="${t.title}" | timechart span=1h avg(scan_count) as scan_count`)+s,v=n+encodeURIComponent(`index=_internal sourcetype=scheduler result_count=* savedsearch_name="${t.title}" | timechart span=1h avg(result_count) as result_count`)+s,u=`/app/${t.app}/search?q=${/^\s*\|/.test(t.search)?"":"search%20"}${encodeURIComponent(t.search)}&earliest=${t.earliest||"-24h"}&latest=${t.latest||"now"}`,p=`/manager/searchplus/saved/searches?app=${t.app}&count=10&offset=0&itemType=&owner=${t.owner}&search=%22${encodeURIComponent(t.title)}%22`,h=`/app/SplunkEnterpriseSecuritySuite/correlation_search_edit?search=${encodeURIComponent(t.title)}`,m="yes"==t.correlation_search?h:p,b=`/app/searchplus/search_change_history?keyword=${encodeURIComponent(t.title)}`,_=e(`\n                    <li>\n                        <div class="search-header">\n                            <div><i class="icon icon-arrow-right"></i></div>\n                            <div>${t.title}</div>\n                            <div>${t.app}</div>\n                            <div>${t.owner}</div>\n                            <div>${t.updated}</div>\n                            <div>${t.next_scheduled_time}</div>\n                            <div>${t.sharing}</div>\n                            <div><i class="icon icon-${t.status}"></i>${t.status}</div>\n                        </div>\n                        <div class="search-details">\n                            <div class="nav-container">\n                                <nav role="tablist">\n                                    <a href="#" aria-controls="general" role="tab" class="selected">General</a>\n                                    <a href="#" aria-controls="attributes" role="tab">Attributes</a>\n                                    <a href="#" aria-controls="statistics" role="tab">Statistics</a>\n                                </nav>\n                                <div>\n                                    <a target="_blank" href="${m}" class="btn-edit-search btn-light"><i class="icon icon-external"></i>Edit Search</a>\n                                    <a target="_blank" href="${b}" class="btn-change-history btn-light"><i class="icon icon-external"></i>Change History</a>\n                                </div>\n                            </div>\n                            <div class="search-details-content">\n                                <section id="general" role="tabpanel" class="selected">\n                                    <div class="query-container">\n                                        <div class="query-overflow" data-simplebar>\n                                            <div class="spl-query">${i(t.search)}</div>\n                                        </div>\n                                        <menu role="list">\n                                            <li><a href="${u}" target="_blank" class="query-search btn-primary"><i class="icon icon-search"></i>Search</a></li>\n                                            <li><a href="#" class="query-copy btn-primary"><i class="icon icon-copy"></i>Copy</a></li>\n                                        </menu>\n                                    </div>\n                                    <div class="description-container">\n                                        <div class="timing-container">\n                                            <span class="icon-tag" data-attr-tooltip="Timespan"><i class="icon icon-timespan"></i><span>${t.earliest||"N/A"} - ${t.latest||"N/A"}</span></span>\n                                            <span class="icon-tag" data-attr-tooltip="Schedule"><i class="icon icon-calendar"></i><span>${t.cron_schedule||"Not Scheduled"}</span></span>\n                                        </div>\n                                        <h2>Description</h2>\n                                        <p>${t.description||"No description."}</p>\n                                    </div>\n                                </section>\n                                <section id="attributes" role="tabpanel" class="hidden">\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-command"></i>Commands</div>\n                                        <div class="attribute-container">${a._makeAttrMarkup(t.command)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-datamodel"></i>Datamodels</div>\n                                        <div class="attribute-container">${a._makeAttrMarkup(t.datamodel)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-field"></i>Fields</div>\n                                        <div class="attribute-container">${a._makeAttrMarkup(t.field)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-function"></i>Functions</div>\n                                        <div class="attribute-container">${a._makeAttrMarkup(t.function)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-index"></i>Indexes</div>\n                                        <div class="attribute-container">${a._makeAttrMarkup(t.index)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-lookup"></i>Lookups</div>\n                                        <div class="attribute-container">${a._makeAttrMarkup(t.lookup)}</div>\n                                    </div>\n                                    <div>\n                                        <div class="attribute-label"><i class="icon icon-macro"></i>Macros</div>\n                                        <div class="attribute-container">${a._makeAttrMarkup(t.macro)}</div>\n                                    </div>\n                                </section>\n                                <section id="statistics" role="tabpanel" class="hidden">\n                                    <div class="stat-${t.skipped_status||"green"}">\n                                        <div class="stat-label">Skipped Percent</div>\n                                        <div class="stat-value">${t.skipped||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" data-attr-tooltip="Open in Search" href="${l}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.latency_status||"green"}">\n                                        <div class="stat-label">Average Search Delay</div>\n                                        <div class="stat-value">${t.latency||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" data-attr-tooltip="Open in Search" href="${c}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.run_time_status||"green"}">\n                                        <div class="stat-label">Average Run Time</div>\n                                        <div class="stat-value">${t.run_time||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" data-attr-tooltip="Open in Search" href="${r}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.mem_used_status||"green"}">\n                                        <div class="stat-label">Average Memory Used</div>\n                                        <div class="stat-value">${t.mem_used||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" data-attr-tooltip="Open in Search" href="${d}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.scan_count_status||"green"}">\n                                        <div class="stat-label">Average Events Scanned</div>\n                                        <div class="stat-value">${t.scan_count||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" data-attr-tooltip="Open in Search" href="${o}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                    <div class="stat-${t.result_count_status||"green"}">\n                                        <div class="stat-label">Average Result Count</div>\n                                        <div class="stat-value">${t.result_count||"N/A"}</div>\n                                        <a class="stat-drilldown btn-light" target="_blank" data-attr-tooltip="Open in Search" href="${v}"><i class="icon icon-external right-align"></i></a>\n                                    </div>\n                                </section>\n                            </div>\n                        </div>\n                    </li>\n                `);"yes"==t.correlation_search&&(e(".search-details nav",_).append('<a href="#" aria-controls="correlation" role="tab">Correlation Search</a>'),e(".search-details-content",_).append(`\n                        <section id="correlation" role="tabpanel" class="hidden">\n                            <div>\n                                <div class="attribute-label"><i class="icon icon-correlation"></i>Correlation Details</div>\n                                <div class="attribute-container">\n                                    <dl><dt>Security Domain:</dt><dd> ${t.security_domain||"N/A"}</dd></dl>\n                                    <dl><dt>Severity:</dt><dd> ${t.severity||"N/A"}</dd></dl>\n                                    <dl><dt>Risk Analysis:</dt><dd> ${t.risk||"N/A"}</dd></dl>\n                                    <dl><dt>Notable Event:</dt><dd> ${t.notable||"N/A"}</dd></dl>\n                                </div>\n                            </div>\n                            <div>\n                                <div class="attribute-label"><i class="icon icon-tactic"></i>MITRE ATT&CK Tactic</div>\n                                <div class="attribute-container">${a._makeAttrMarkup(t.mtr_tactic)}</div>\n                            </div>\n                            <div>\n                                <div class="attribute-label"><i class="icon icon-tactic"></i>MITRE ATT&CK Technique</div>\n                                <div class="attribute-container">${a._makeAttrMarkup(t.mtr_technique)}</div>\n                            </div>\n                        </section>\n                    `)),e(".search-header",_).on("click",(function(){$parent=e(this).parent(),e(".search-results li.selected").not($parent).removeClass("selected"),$parent.toggleClass("selected")})),e(".search-details nav a",_).on("click",(function(){if(e(this).hasClass("selected"))return;let a=e(this).closest(".search-details");e("nav a.selected",a).removeClass("selected"),e(this).addClass("selected");let t=e(this).attr("aria-controls");e(".search-details-content section",a).not(`#${t}`).removeClass("selected").addClass("hidden"),e(`#${t}`,a).removeClass("hidden").addClass("selected")})),e(".query-copy",_).on("click",(function(){let a=e(".spl-query",e(this).closest(".query-container")).text(),t=e("i.icon",e(this));navigator.clipboard.writeText(a).then((function(){t.removeClass("icon-copy").addClass("animate-bounce-in icon-check").delay(1e3).queue((function(){t.removeClass("animate-bounce-in icon-check").addClass("icon-copy").dequeue()}))}))})),a.$el.append(_)}))},_makeAttrMarkup:function(a){if(!a)return"";Array.isArray(a)||(a=[a]);let e="";return a.forEach((a=>{"N/A"!=a&&""!=a&&(e+=`<span class="tag">${a}</span>`)})),e}})}));